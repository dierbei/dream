## ubuntu 22.04 安装图形界面
```shell
https://help.aliyun.com/document_detail/41227.html?spm=a2c4g.25365.0.i2
```

## 安装 crictl
```shell
https://github.com/dierbei/dream/blob/master/Kubernetes/5.%20install%20containerd.md
```

## 下载 containerd 其他 bin
```shell
https://github.com/containerd/containerd/releases

# containerd 配置
https://github.com/kuasar-io/kuasar/blob/main/docs/containerd.md
```

## wasmedge
```shell
wget https://raw.githubusercontent.com/WasmEdge/WasmEdge/master/utils/install.sh
chmod +x install.sh
./install.sh -e all -v 0.11.2 -s -- -p /usr/local
```

## 终端超时
```text
vim /etc/profile编辑系统环境变量，在文件中添加export TMOUT=300（用户自定义时间）。

保存文件之后，输入命令：source /etc/priofile，加载已配置的系统环境。

300秒空闲等待之后，系统会自动断开远程ssh连接。
```

## 过程
```shell
# 初始化 git
sudo apt update
sudo apt install git
git config --global user.name "dierbei"
git config --global user.email "1628652790@qq.com"
git config --global user.name
git config --global user.email
ssh-keygen -t rsa -b 4096 -C "1628652790@qq.com"

# 安装 rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
cargo install cargo-deny

# 库
sudo apt-get install libelf-dev

# 安装 flex
sudo apt-get install flex

# 安装 bison
sudo apt-get install bison
bison --version

# 安装 wasmedge 注意版本
curl -sSf https://raw.githubusercontent.com/WasmEdge/WasmEdge/master/utils/install.sh | bash
source $HOME/.wasmedge/env

# 安装 cmake
sudo apt-get install gcc g++
wget https://cmake.org/files/v3.21/cmake-3.21.0.tar.gz
tar -zxvf cmake-3.21.0.tar.gz
cd cmake-3.21.0
./bootstrap
make
sudo make install

# 安装 
sudo apt-get install libssl-dev
export OPENSSL_ROOT_DIR=/root/dierbei/openssl
cmake -DCMAKE_USE_OPENSSL=OFF /root/dierbei/openssl

# 安装 共享库
sudo apt install -y clang
sudo apt install -y libclang-dev

# 安装 runc
sudo apt-get install libseccomp-dev
sudo yum install libseccomp-devel
git clone https://github.com/opencontainers/runc.git
cd runc
make
sudo cp runc /usr/local/bin

# 安装 containerd
https://github.com/kuasar-io/kuasar/blob/main/docs/containerd.md

# 安装 quark
https://github.com/kuasar-io/kuasar/blob/main/docs/quark/README.md

# 安装 microVM
https://github.com/cloud-hypervisor/cloud-hypervisor/blob/main/docs/building.md

# microVM required
https://gitlab.com/virtio-fs/virtiofsd

# 安装 crictl
https://github.com/kubernetes-sigs/cri-tools/blob/master/docs/crictl.md#install-crictl

# 启动 kuasar
nohup vmm-sandboxer --listen /run/vmm-sandboxer.sock --dir /run/kuasar-vmm &
nohup quark-sandboxer --listen /run/quark-sandboxer.sock --dir /var/lib/kuasar-quark &
nohup wasm-sandboxer --listen /run/wasm-sandboxer.sock --dir /run/kuasar-wasm &
```

## 远程开发
```shell
https://blog.csdn.net/K346K346/article/details/105822846
```

## 启动 containerd
```shell
ENABLE_CRI_SANDBOXES=1 containerd
```

## k8s 集成

### wasm example
```yaml
apiVersion: node.k8s.io/v1
kind: RuntimeClass
metadata:
  name: kuasar-wasm-runtime
handler: wasm
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: wasm-example
spec:
  replicas: 1
  selector:
    matchLabels:
      app: wasm-example
  template:
    metadata:
      labels:
        app: wasm-example
    spec:
      runtimeClassName: kuasar-wasm-runtime
      containers:
        - name: wasm
          image: dierbei/csi_demo:rust-example-hello
          ports:
            - containerPort: 3030
---
apiVersion: v1
kind: Service
metadata:
  name: wasm-example-service
spec:
  selector:
    app: wasm-example
  ports:
    - name: port
      protocol: TCP
      port: 80
      targetPort: 3030
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: test-nginx
spec:
  replicas: 1
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
        - name: nginx
          image: nginx:latest
          ports:
            - containerPort: 80
```
```shell
kubectl exec -it <pod-name> -- curl wasm-example-service
```